import { useEffect,useState,useRef } from "react";import { io } from "socket.io-client";import { BACKEND_URL } from "../config";import { addScore, addHistory } from "../utils/storage";let socket;export default function TicTacToe(){const [connected,setConnected]=useState(false);const [roomId,setRoomId]=useState("");const [name,setName]=useState("");const [board,setBoard]=useState(Array(9).fill(null));const [playerSymbol,setPlayerSymbol]=useState(null);const [status,setStatus]=useState("Not in room");const playersRef=useRef([]);useEffect(()=>{socket=io(BACKEND_URL);socket.on("connect",()=>setConnected(true));socket.on("roomData",(room)=>{playersRef.current=room.players||[];setStatus(`Players: ${room.players.map(p=>p.name).join(", ")}`);const idx=room.players.findIndex(p=>p.id===socket.id);setPlayerSymbol(idx===0?"X":(idx===1?"O":null));});socket.on("updateBoard",(state)=>{const newBoard=Array(9).fill(null);Object.entries(state).forEach(([idx,sym])=>newBoard[Number(idx)]=sym);setBoard(newBoard);const win=calcWinner(newBoard);if(win){setStatus(`Winner: ${win}`);addHistory("TicTacToe",`Winner: ${win}`);addScore("TicTacToe",win==="Draw"?0:1);}});return ()=>socket.disconnect();},[]);function join(room,playerName){if(!room||!playerName) return alert("Enter room & name");setRoomId(room);setName(playerName);socket.emit("joinRoom",{roomId:room,playerName,game:"TicTacToe"});}function clickCell(i){if(!playerSymbol) return alert("Wait for another player to join");if(board[i]) return;socket.emit("move",{roomId,move:{index:i,player:playerSymbol}});}function newRoom(){const r=Math.random().toString(36).slice(2,8);join(r,name||"Player");}return (<div className="container"><div className="card"><h2>Tic-Tac-Toe (Multiplayer)</h2><div className="kv"><input className="name" placeholder="Your name" value={name} onChange={e=>setName(e.target.value)} /></div><div className="kv"><input className="room" placeholder="Room ID (or press New Room)" value={roomId} onChange={e=>setRoomId(e.target.value)} /><button className="btn" onClick={()=>join(roomId,name)}>Join Room</button><button className="btn muted" onClick={newRoom}>New Room</button></div><div className="small">You are: <strong>{playerSymbol||"Spectator"}</strong></div><div style={{marginTop:12}}><div className="board">{board.map((c,i)=>{const winner=calcWinner(board);return (<div key={i} className={"cell "+(c?"":"")} onClick={()=>clickCell(i)} style={{background: winner? "rgba(74,144,226,0.08)":undefined}}>{c||""}</div>);})}</div></div><div style={{marginTop:8}} className="small">{status}</div></div></div>);}function calcWinner(b){const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const [a,b1,c] of lines){if(b[a]&&b[a]===b[b1]&&b[a]===b[c]) return b[a];}if(b.every(Boolean)) return "Draw";return null;}